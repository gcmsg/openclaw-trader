# openclaw-trader äº§å“æ¶æ„æ–‡æ¡£

> ç‰ˆæœ¬ï¼š2026-02-26 | ä½œè€…ï¼šMiaï¼ˆæ¶æ„æ–‡æ¡£ç¼–å†™è€…ï¼‰
> åŸºäºä»£ç å®¡è®¡ç”Ÿæˆï¼Œä¸å®é™…ä»£ç ä¿æŒä¸€è‡´ã€‚

---

## ç›®å½•

1. [é¡¹ç›®å®šä½ä¸è®¾è®¡ç†å¿µ](#1-é¡¹ç›®å®šä½ä¸è®¾è®¡ç†å¿µ)
2. [ç³»ç»Ÿæ¶æ„æ€»è§ˆ](#2-ç³»ç»Ÿæ¶æ„æ€»è§ˆ)
3. [ä¿¡å·ç®¡çº¿è¯¦è§£](#3-ä¿¡å·ç®¡çº¿è¯¦è§£)
4. [æ‰§è¡Œå¼•æ“è¯¦è§£](#4-æ‰§è¡Œå¼•æ“è¯¦è§£)
5. [é…ç½®ä½“ç³»](#5-é…ç½®ä½“ç³»)
6. [æ•°æ®æµä¸å­˜å‚¨](#6-æ•°æ®æµä¸å­˜å‚¨)
7. [å®šæ—¶ä»»åŠ¡ä½“ç³»](#7-å®šæ—¶ä»»åŠ¡ä½“ç³»)
8. [é£æ§ä½“ç³»](#8-é£æ§ä½“ç³»)
9. [è¾…åŠ©å·¥å…·](#9-è¾…åŠ©å·¥å…·)
10. [å®¡è®¡å‘ç°](#å®¡è®¡å‘ç°)

---

## 1. é¡¹ç›®å®šä½ä¸è®¾è®¡ç†å¿µ

### 1.1 é¡¹ç›®æ˜¯ä»€ä¹ˆ

openclaw-trader æ˜¯ä¸€å¥—**åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿ**ï¼Œæ ¸å¿ƒå®šä½æ˜¯ã€Œ**æ„ŸçŸ¥ + æ‰§è¡Œå·¥å…·**ã€ï¼Œè€Œéå…¨è‡ªåŠ¨å†³ç­–ç³»ç»Ÿã€‚

ç³»ç»Ÿè®¾è®¡éµå¾ªä¸‰æ–¹åˆ†å·¥åŸåˆ™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸‰æ–¹è§’è‰²åˆ†å·¥                              â”‚
â”‚                                                             â”‚
â”‚  openclaw-traderï¼ˆç³»ç»Ÿï¼‰                                     â”‚
â”‚    â””â”€â”€ æ„ŸçŸ¥å·¥å…·ï¼šè¡Œæƒ…é‡‡é›†ã€æŒ‡æ ‡è®¡ç®—ã€ä¿¡å·è¿‡æ»¤ã€é£é™©æ£€æŸ¥        â”‚
â”‚          â†“ ä¿¡å·é€šçŸ¥ï¼ˆTelegramï¼‰                              â”‚
â”‚  Miaï¼ˆAI åˆ¤æ–­ä¸»ä½“ï¼‰                                          â”‚
â”‚    â””â”€â”€ è§£è¯»ä¿¡å·ã€ç»¼åˆå®è§‚åˆ¤æ–­ã€æå‡ºå»ºè®®                       â”‚
â”‚          â†“ æ±‡æŠ¥ + å»ºè®®                                       â”‚
â”‚  ä¸»äººï¼ˆTerryï¼Œæœ€ç»ˆå†³ç­–è€…ï¼‰                                    â”‚
â”‚    â””â”€â”€ å®¡æ‰¹äº¤æ˜“ã€è°ƒæ•´ç­–ç•¥å‚æ•°ã€æœ€ç»ˆæ‹æ¿                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒåŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **ä¸è‡ªåŠ¨å¼€ä»“ï¼ˆä¸»ç½‘ï¼‰** | å®ç›˜ä¿¡å·ä»…é€šçŸ¥ï¼Œç”±ä¸»äººæˆæƒåæ‰§è¡Œ |
| **testnet é™¤å¤–** | Testnet åœºæ™¯å¯è‡ªåŠ¨ä¸‹å•ï¼Œç”¨äºç­–ç•¥éªŒè¯ |
| **ä¿¡å·éœ€æˆæƒ** | live-monitor åœ¨å®ç›˜æ¨¡å¼ä¸‹éœ€é…ç½® `allowed: true` æ‰æ‰§è¡Œ |
| **å¤šå±‚é˜²æŠ¤** | Kill Switch / Emergency Halt / Daily Loss Limit / Protection Manager |

### 1.3 æŠ€æœ¯æ ˆ

- è¯­è¨€ï¼šTypeScriptï¼ˆESM æ¨¡å—ï¼‰
- è¿è¡Œæ—¶ï¼šNode.js v25+
- è¡Œæƒ…æ•°æ®ï¼šBinance REST API
- é…ç½®ï¼šYAML ä¸‰å±‚åˆå¹¶
- æŒä¹…åŒ–ï¼šJSON æ–‡ä»¶ï¼ˆåŸå­å†™å…¥ï¼‰+ SQLiteï¼ˆå¯é€‰ï¼Œ`G5`ï¼‰
- é€šçŸ¥ï¼šTelegram Botï¼ˆvia openclaw é€šçŸ¥ä¸­å¿ƒï¼‰

---

## 2. ç³»ç»Ÿæ¶æ„æ€»è§ˆ

### 2.1 æ•°æ®æµ ASCII æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         openclaw-trader æ•°æ®æµ                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚ Binance API  â”‚                                                            â”‚
â”‚  â”‚ (REST/WS)    â”‚                                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚         â”‚ Kçº¿æ•°æ®ï¼ˆ1h + 4h MTFï¼‰                                              â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  DataProvider    â”‚  æ‰¹é‡æ‹‰å– + å†…å­˜ç¼“å­˜ï¼ˆå‡å°‘é‡å¤ API è¯·æ±‚ï¼‰               â”‚
â”‚  â”‚  data-provider.tsâ”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚ Kline[]                                                            â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚                 æŒ‡æ ‡è®¡ç®—ï¼ˆcalculateIndicatorsï¼‰            â”‚               â”‚
â”‚  â”‚  EMA(20/60) Â· RSI(14) Â· MACD(12/26/9) Â· ATR Â· VWAP Â· CVD â”‚               â”‚
â”‚  â”‚  indicators.ts                                           â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ æ³¨å…¥å¤–éƒ¨æ•°æ®ï¼ˆèµ„é‡‘è´¹ç‡ Â· BTCä¸»å¯¼ç‡ Â· CVDç¼“å­˜ Â· æŒä»“æ–¹å‘ï¼‰            â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚              ç»Ÿä¸€ä¿¡å·å¼•æ“ processSignal()                  â”‚               â”‚
â”‚  â”‚  signal-engine.ts                                        â”‚               â”‚
â”‚  â”‚                                                          â”‚               â”‚
â”‚  â”‚  ç­–ç•¥æ’ä»¶é€‰æ‹© â†’ ä¿¡å·æ£€æµ‹ â†’ Regimeè¿‡æ»¤ â†’ R:Rè¿‡æ»¤            â”‚               â”‚
â”‚  â”‚  â†’ ç›¸å…³æ€§è¿‡æ»¤ â†’ Protection Manager                        â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â”‚ åç»­è¿‡æ»¤é“¾ï¼ˆåœ¨ monitor.ts / live-monitor.ts ä¸­æ‰§è¡Œï¼‰                â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ç´§æ€¥æš‚åœæ£€æŸ¥         â”‚   â”‚  äº‹ä»¶æ—¥å†é£é™©æ§åˆ¶                     â”‚        â”‚
â”‚  â”‚  readEmergencyHalt() â”‚   â”‚  checkEventRisk()                   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                          â”‚                                         â”‚
â”‚         â–¼                          â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  MTF è¶‹åŠ¿è¿‡æ»¤        â”‚   â”‚  æƒ…ç»ªé—¨æ§                             â”‚        â”‚
â”‚  â”‚  4h EMA å¤šç©ºåˆ¤æ–­     â”‚   â”‚  evaluateSentimentGate()            â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                          â”‚                                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                    â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚         Kelly ä»“ä½è®¡ç®—               â”‚                                   â”‚
â”‚  â”‚         calcKellyRatio()             â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚         â”‚                                                                    â”‚
â”‚         â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Paper Engine      â”‚         â”‚ Live Executor                 â”‚            â”‚
â”‚  â”‚ engine.ts         â”‚         â”‚ executor.ts                   â”‚            â”‚
â”‚  â”‚ (æ¨¡æ‹Ÿä¸‹å•)         â”‚         â”‚ (çœŸå® Binance API ä¸‹å•)        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                                 â”‚                                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                        â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚                   é€šçŸ¥ä¸­å¿ƒ                                â”‚               â”‚
â”‚  â”‚   notify/openclaw.ts â†’ Telegram                          â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åŒç®¡çº¿æ¶æ„

ç³»ç»Ÿä»¥**ä¸¤æ¡å¹¶è¡Œç®¡çº¿**è¦†ç›–ä¸åŒéœ€æ±‚ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          åŒç®¡çº¿å¹¶è¡Œæ¶æ„                                        â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç®¡çº¿ Aï¼šCron Monitor             â”‚  â”‚  ç®¡çº¿ Bï¼šLive Monitor Daemon     â”‚  â”‚
â”‚  â”‚  src/monitor.ts                  â”‚  â”‚  src/scripts/live-monitor.ts    â”‚  â”‚
â”‚  â”‚                                  â”‚  â”‚                                 â”‚  â”‚
â”‚  â”‚  è§¦å‘æ–¹å¼ï¼šcron æ¯åˆ†é’Ÿæ‰§è¡Œ         â”‚  â”‚  è§¦å‘æ–¹å¼ï¼šå¸¸é©» tmux è¿›ç¨‹è½®è¯¢    â”‚  â”‚
â”‚  â”‚  æ‰§è¡Œå¼•æ“ï¼šPaper Engine           â”‚  â”‚  æ‰§è¡Œå¼•æ“ï¼šLive Executor         â”‚  â”‚
â”‚  â”‚  æ¨¡å¼ï¼š    æ¨¡æ‹Ÿäº¤æ˜“ï¼ˆpaperï¼‰       â”‚  â”‚  æ¨¡å¼ï¼š    çœŸå®/Testnet ä¸‹å•     â”‚  â”‚
â”‚  â”‚  çŠ¶æ€æ–‡ä»¶ï¼šlogs/state-{id}.json   â”‚  â”‚  çŠ¶æ€ï¼š    å†…å­˜ + è´¦æˆ·æ–‡ä»¶       â”‚  â”‚
â”‚  â”‚                                  â”‚  â”‚                                 â”‚  â”‚
â”‚  â”‚  å¹¶è¡Œè¿è¡Œæ‰€æœ‰ enabled åœºæ™¯         â”‚  â”‚  è¿è¡Œ testnet-default åœºæ™¯       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  âš ï¸  ä¸¤æ¡ç®¡çº¿å…±åŒçº¦æŸï¼šå¿…é¡»è°ƒç”¨åŒä¸€ä¸ª processSignal() å‡½æ•°                     â”‚
â”‚      ä»»ä½•ä¿¡å·é€»è¾‘åªæ”¹ä¸€å¤„ï¼Œå¿…é¡»åŒæ—¶ç¡®ä¿ä¸¤æ¡ç®¡çº¿å‡åŒæ­¥                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®è§„åˆ™**ï¼š`signal-engine.ts` ä¸­çš„ `processSignal()` æ˜¯å”¯ä¸€çš„ä¿¡å·é€»è¾‘æºå¤´ã€‚`monitor.ts` å’Œ `live-monitor.ts` éƒ½ä»¥å®Œå…¨ç›¸åŒçš„å‚æ•°è°ƒç”¨å®ƒï¼Œç¦æ­¢åœ¨å„è‡ªæ–‡ä»¶å†…å•ç‹¬å®ç°ä¿¡å·æ¡ä»¶ã€‚

---

## 3. ä¿¡å·ç®¡çº¿è¯¦è§£

æ•´ä¸ªä¿¡å·ç®¡çº¿æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ã€‚ä¸‹è¡¨ä¸ºæ€»è§ˆï¼š

| æ­¥éª¤ | æ¨¡å—æ–‡ä»¶ | å‡½æ•° | çŠ¶æ€ |
|------|----------|------|------|
| 1. Kçº¿è·å– | `exchange/data-provider.ts` | `DataProvider.get()` | âœ… |
| 2. æŒ‡æ ‡è®¡ç®— | `strategy/indicators.ts` | `calculateIndicators()` | âœ… |
| 3. å¤–éƒ¨æ•°æ®æ³¨å…¥ | å¤šæ¨¡å— | è§ä¸‹æ–‡ | âœ… |
| 4. ç­–ç•¥æ’ä»¶é€‰æ‹© | `strategies/registry.ts` | `getStrategy()` | âœ… |
| 5. ä¿¡å·æ¡ä»¶åŒ¹é… | `strategy/signals.ts` | `detectSignal()` | âœ… |
| 6. Regime æ„ŸçŸ¥è¿‡æ»¤ | `strategy/regime.ts` | `classifyRegime()` | âœ… |
| 7. R:R è¿‡æ»¤ | `strategy/rr-filter.ts` | `checkRiskReward()` | âœ… |
| 8. ç›¸å…³æ€§è¿‡æ»¤ | `strategy/correlation.ts` | `checkCorrelation()` | âœ… |
| 9. Protection Manager | `strategy/protection-manager.ts` | `checkProtections()` | âœ… |
| 10. ç´§æ€¥æš‚åœ | `news/emergency-monitor.ts` | `readEmergencyHalt()` | âœ… |
| 11. äº‹ä»¶æ—¥å† | `strategy/events-calendar.ts` | `checkEventRisk()` | âœ… |
| 12. MTF è¶‹åŠ¿è¿‡æ»¤ | `monitor.ts` / `live-monitor.ts` | æ‰‹åŠ¨ `calculateIndicators` | âœ… |
| 13. æƒ…ç»ªé—¨æ§ | `news/sentiment-gate.ts` | `evaluateSentimentGate()` | âœ… |
| 14. Kelly ä»“ä½ | `strategy/kelly.ts` | `calcKellyRatio()` | â³ |
| 15. æ‰§è¡Œ | `paper/engine.ts` / `live/executor.ts` | `handleSignal()` | âœ… |

---

### æ­¥éª¤ 1ï¼šKçº¿è·å–

**æ–‡ä»¶**ï¼š`src/exchange/data-provider.ts`ã€`src/exchange/binance.ts`

`DataProvider` æ˜¯ K çº¿æ•°æ®çš„ç»Ÿä¸€å…¥å£ï¼Œæ”¯æŒæ‰¹é‡é¢„æ‹‰å–å’Œå†…å­˜ç¼“å­˜ã€‚

```
DataProvider.prefetch(symbols, timeframe, limit)
  â†’ æ‰¹é‡å¹¶è¡Œè¯·æ±‚ Binance REST API
  â†’ å°†ç»“æœå­˜å…¥å†…å­˜ Map<symbol-timeframe, Kline[]>

DataProvider.get(symbol, timeframe)
  â†’ ç›´æ¥è¿”å›ç¼“å­˜ï¼ˆO(1)ï¼Œé¿å…é‡å¤è¯·æ±‚ï¼‰
  â†’ ç¼“å­˜æœªå‘½ä¸­ â†’ å›é€€åˆ° getKlines() ç›´æ¥æ‹‰å–
```

æ¯æ¬¡æ‰«ææ‰€éœ€ K çº¿æ•°é‡ï¼š

```typescript
const limit = Math.max(cfg.strategy.ma.long, cfg.strategy.rsi.period, macdMinBars) + 10;
// ä¾‹å¦‚ï¼šmax(60, 14, 26+9+1) + 10 = 60 + 10 = 70 æ ¹
```

K çº¿ç±»å‹ï¼ˆ`src/types.ts`ï¼Œ`Kline` æ¥å£ï¼‰ï¼š

```typescript
interface Kline {
  openTime: number;
  open: number;
  high: number;
  low: number;
  close: number;
  volume: number;
  closeTime: number;
}
```

---

### æ­¥éª¤ 2ï¼šæŒ‡æ ‡è®¡ç®—

**æ–‡ä»¶**ï¼š`src/strategy/indicators.ts`

å‡½æ•° `calculateIndicators(klines, maShort, maLong, rsiPeriod, macdCfg)` è¿”å› `Indicators | null`ï¼ˆæ•°æ®ä¸è¶³æ—¶è¿”å› nullï¼‰ã€‚

è®¡ç®—çš„æŒ‡æ ‡ï¼š

| æŒ‡æ ‡ | ç®—æ³• | é…ç½®å‚æ•° |
|------|------|---------|
| EMA Short | æŒ‡æ•°ç§»åŠ¨å¹³å‡ | `strategy.ma.short`ï¼ˆé»˜è®¤ 20ï¼‰|
| EMA Long | æŒ‡æ•°ç§»åŠ¨å¹³å‡ | `strategy.ma.long`ï¼ˆé»˜è®¤ 60ï¼‰|
| RSI | ç›¸å¯¹å¼ºå¼±æŒ‡æ•° | `strategy.rsi.period`ï¼ˆé»˜è®¤ 14ï¼‰|
| MACD | MACD(12,26,9) | `strategy.macd.fast/slow/signal` |
| ATR | å¹³å‡çœŸå®æ³¢å¹… | å†…éƒ¨è®¡ç®—ï¼Œç”¨äºåŠ¨æ€ä»“ä½ |
| VWAP | æˆäº¤é‡åŠ æƒå‡ä»· | è‡ªåŠ¨è®¡ç®—ï¼Œå«ä¸Šä¸‹ 2Ïƒ å¸¦ |
| æˆäº¤é‡ | å½“å‰ vs å‡é‡ | `strategy.volume.surge_ratio` |

`Indicators` æ¥å£ï¼ˆ`src/types.ts`ï¼‰åŒ…å«ï¼š
- `maShort`, `maLong`ï¼šå½“å‰ EMA å€¼
- `prevMaShort`, `prevMaLong`ï¼šå‰ä¸€æ ¹ K çº¿ EMAï¼ˆç”¨äºåˆ¤æ–­é‡‘å‰/æ­»å‰ï¼‰
- `rsi`ï¼šå½“å‰ RSI
- `macd`ï¼š`{ macd, signal, histogram, prevMacd, prevSignal, prevHistogram, prevPrevHistogram }`
- `atr`ï¼šå½“å‰ ATR å€¼
- `vwap`, `vwapUpper2`, `vwapLower2`ï¼šVWAP åŠå¸ƒæ—å¸¦
- `price`, `prevPrice`ï¼šå½“å‰/å‰ä¸€æ ¹æ”¶ç›˜ä»·
- `volume`, `avgVolume`ï¼šå½“å‰æˆäº¤é‡ / è¿‘ 20 æ ¹å‡é‡

å¤–éƒ¨æ³¨å…¥å­—æ®µï¼ˆæ­¥éª¤ 3 å†™å…¥ï¼‰ï¼š
- `cvd`ï¼šç´¯è®¡æˆäº¤é‡å·®å€¼
- `fundingRate`ï¼šèµ„é‡‘è´¹ç‡ç™¾åˆ†æ¯”
- `btcDominance`, `btcDomChange`ï¼šBTC ä¸»å¯¼ç‡åŠå˜åŒ–

---

### æ­¥éª¤ 3ï¼šå¤–éƒ¨æ•°æ®æ³¨å…¥

**æ–‡ä»¶**ï¼š
- `src/exchange/order-flow.ts` â†’ CVD ç¼“å­˜
- `src/strategy/funding-rate-signal.ts` â†’ èµ„é‡‘è´¹ç‡
- `src/strategy/btc-dominance.ts` â†’ BTC ä¸»å¯¼ç‡

åœ¨ `processSignal()` è°ƒç”¨ä¹‹å‰ï¼Œ`monitor.ts` / `live-monitor.ts` åˆ†åˆ«æ³¨å…¥ä»¥ä¸‹å¤–éƒ¨ä¸Šä¸‹æ–‡ï¼š

```
ExternalContext {
  cvd?         â† order-flow.ts readCvdCache(symbol)ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
  fundingRate? â† funding-rate-signal.ts fetchFundingRatePct(symbol)ï¼ˆ10åˆ†é’Ÿç¼“å­˜ï¼‰
  btcDominance? â† btc-dominance.ts getBtcDominanceTrend().latest
  btcDomChange? â† btc-dominance.ts getBtcDominanceTrend().changeï¼ˆ7æ—¥å˜åŒ–ï¼‰
  currentPosSide? â† paper/account.ts loadAccount().positions[symbol].side
  heldKlinesMap?  â† ç›¸å…³æ€§æ£€æŸ¥ç”¨ï¼šå·²æŒä»“å„ symbol çš„ K çº¿
}
```

æ³¨å…¥é€»è¾‘ï¼ˆä¸¤æ¡ç®¡çº¿å®Œå…¨ä¸€è‡´ï¼‰ï¼š

```typescript
// èµ„é‡‘è´¹ç‡ï¼ˆæœŸè´§/æ°¸ç»­åˆçº¦ï¼Œå¸¦10åˆ†é’Ÿç¼“å­˜ï¼Œå¤±è´¥é™é»˜è·³è¿‡ï¼‰
const frPct = await fetchFundingRatePct(symbol);

// BTC ä¸»å¯¼ç‡è¶‹åŠ¿ï¼ˆè¯»å†å²æ–‡ä»¶ï¼Œéé˜»å¡ï¼‰
const domTrend = getBtcDominanceTrend();

// çœŸå® CVDï¼ˆè‹¥ CvdManager å·²å†™å…¥ç¼“å­˜ï¼Œä¼˜å…ˆç”¨çœŸå®æ•°æ®ï¼Œ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰
const realCvd = readCvdCache(symbol);

// æŒä»“æ–¹å‘ + ç›¸å…³æ€§Kçº¿
const currentPosSide = loadAccount(...).positions[symbol]?.side;
```

---

### æ­¥éª¤ 4ï¼šç­–ç•¥æ’ä»¶é€‰æ‹©

**æ–‡ä»¶**ï¼š`src/strategies/registry.ts`ã€`src/strategies/index.ts`ã€`src/strategies/types.ts`

ç³»ç»Ÿæ”¯æŒç­–ç•¥æ’ä»¶æœºåˆ¶ï¼ˆ`F4`ï¼‰ï¼š

```
strategy_idï¼ˆæ¥è‡ªé…ç½®ï¼‰
  â†“
"default" â†’ èµ°ç»å…¸ detectSignal() è·¯å¾„ï¼ˆSIGNAL_CHECKERS mapï¼‰
å…¶ä»–å€¼    â†’ getStrategy(strategyId) â†’ plugin.populateSignal(ctx)
```

å†…ç½®ç­–ç•¥ï¼š
- `default`ï¼šç»å…¸ MA + RSI + MACD è¶‹åŠ¿è·Ÿéš
- `rsi-reversal`ï¼šRSI è¶…ä¹°è¶…å–åè½¬ç­–ç•¥
- `breakout`ï¼šçªç ´ç­–ç•¥

æ’ä»¶æ¥å£ï¼ˆ`StrategyContext`ï¼‰ï¼š
```typescript
interface StrategyContext {
  klines: Kline[];
  cfg: StrategyConfig;
  indicators: Indicators;
  currentPosSide?: "long" | "short";
}
```

`populateSignal(ctx)` è¿”å› `Signal["type"]`ï¼ˆ`"buy" | "sell" | "short" | "cover" | "none"`ï¼‰ã€‚

---

### æ­¥éª¤ 5ï¼šä¿¡å·æ¡ä»¶åŒ¹é…

**æ–‡ä»¶**ï¼š`src/strategy/signals.ts`

`SIGNAL_CHECKERS` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² â†’ å‡½æ•°çš„æ˜ å°„è¡¨ï¼Œæ‰€æœ‰å¯ç”¨æ¡ä»¶å‡åœ¨æ­¤æ³¨å†Œï¼š

```
SIGNAL_CHECKERS: Record<string, SignalChecker>
  ma_golden_cross / ma_death_cross / ma_bullish / ma_bearish
  rsi_oversold / rsi_overbought / rsi_not_overbought / rsi_not_oversold
  rsi_bullish_zone / rsi_overbought_exit
  macd_golden_cross / macd_death_cross / macd_bullish / macd_bearish
  macd_histogram_expanding / macd_histogram_shrinking
  price_above_vwap / price_below_vwap / vwap_bounce / vwap_breakdown
  price_above_vwap_upper2 / price_below_vwap_lower2
  btc_dominance_rising / btc_dominance_falling
  funding_rate_overlong / funding_rate_overshort
  cvd_bullish / cvd_bearish
  volume_surge / volume_low
```

`detectSignal()` å‡½æ•°å®ç°æŒä»“æ„ŸçŸ¥çš„ä¼˜å…ˆçº§é€»è¾‘ï¼š

```
æŒå¤šå¤´ï¼ˆlongï¼‰â†’ åªæ£€æŸ¥ sell æ¡ä»¶ï¼ˆå¹³å¤šï¼‰ï¼Œå¿½ç•¥ buy/short/cover
æŒç©ºå¤´ï¼ˆshortï¼‰â†’ åªæ£€æŸ¥ cover æ¡ä»¶ï¼ˆå¹³ç©ºï¼‰ï¼Œå¿½ç•¥ sell/buy/short
æ— æŒä»“         â†’ å…ˆæ£€æŸ¥ buy â†’ å†æ£€æŸ¥ shortï¼ˆå¤šå¤´ä¼˜å…ˆï¼‰
```

ä¿¡å·æ¡ä»¶ **å…¨éƒ¨æ»¡è¶³** æ‰è§¦å‘ï¼ˆAND é€»è¾‘ï¼‰ã€‚å½“å‰ `long-short` ç­–ç•¥æ¡ä»¶ï¼š

| ä¿¡å·ç±»å‹ | æ¡ä»¶ |
|---------|------|
| buyï¼ˆå¼€å¤šï¼‰ | `ma_bullish` AND `macd_golden_cross` AND `rsi_not_overbought` |
| sellï¼ˆå¹³å¤šï¼‰ | `ma_bearish` |
| shortï¼ˆå¼€ç©ºï¼‰| `ma_bearish` AND `macd_death_cross` AND `rsi_not_oversold` |
| coverï¼ˆå¹³ç©ºï¼‰| `ma_bullish` |

---

### æ­¥éª¤ 6ï¼šRegime æ„ŸçŸ¥è¿‡æ»¤

**æ–‡ä»¶**ï¼š`src/strategy/regime.ts`

åœ¨ `processSignal()` å†…éƒ¨ï¼Œå¯¹ **å¼€ä»“ä¿¡å·ï¼ˆbuy/shortï¼‰** æ‰§è¡Œå¸‚åœºç¯å¢ƒï¼ˆRegimeï¼‰åˆ†ç±»ï¼š

```typescript
const regime = classifyRegime(klines);
// è¿”å›ï¼š{ label, signalFilter, confidence, detail }
```

`signalFilter` å–å€¼åŠå¯¹åº”è¡Œä¸ºï¼š

| å€¼ | å«ä¹‰ | è¡Œä¸º |
|----|------|------|
| `breakout_watch` | çªç ´è§‚å¯ŸæœŸï¼Œä¿¡å·ä¸å¯é  | **æ‹’ç»**ä¿¡å· |
| `reduced_size` | å‡ä»“æ¨¡å¼ï¼Œè¶‹åŠ¿ä¸æ˜æœ— | ä»“ä½ Ã— **0.5**ï¼ˆç¼©å‡ä½†ä¸æ‹’ç»ï¼‰|
| `all_clear` | æ­£å¸¸å¸‚åœº | ä¸åšé™åˆ¶ |

ç½®ä¿¡åº¦é˜ˆå€¼ï¼š`regime.confidence >= 60` æ—¶æ‰ç”Ÿæ•ˆã€‚

å¦‚æœé…ç½®äº† `cfg.regime_overrides`ï¼ŒRegime è¿‡æ»¤åŒæ—¶ä¼šåˆå¹¶è¦†ç›– `effectiveRisk`ï¼ˆå¦‚è°ƒæ•´ SL/TP ç™¾åˆ†æ¯”ï¼‰ã€‚

> âš ï¸ **å½“å‰çŠ¶æ€**ï¼š`regime_overrides` éªŒè¯è¡¨æ˜è¿‡æ»¤å­˜åœ¨æ»åç°è±¡ï¼Œtestnet-default åœºæ™¯ä¸­**æœªå¯ç”¨**ï¼ˆâŒï¼‰ã€‚

---

### æ­¥éª¤ 7ï¼šR:R è¿‡æ»¤

**æ–‡ä»¶**ï¼š`src/strategy/rr-filter.ts`

å‡½æ•° `checkRiskReward(klines, price, side, minRr)` åŸºäºè¿‘æœŸ K çº¿çš„æ³¢åŠ¨èŒƒå›´ï¼Œä¼°ç®—å½“å‰å…¥åœºçš„é£é™©/å›æŠ¥æ¯”ï¼š

```
R:R = é¢„æœŸç›ˆåˆ©ç©ºé—´ / é¢„æœŸäºæŸç©ºé—´
```

é…ç½®é¡¹ï¼š`risk.min_rr`ï¼ˆé»˜è®¤ 1.5ï¼Œ0 = ç¦ç”¨ï¼‰

ä»…å¯¹ **å¼€ä»“ä¿¡å·** æ‰§è¡Œï¼Œå¹³ä»“ä¿¡å·ä¸å—å½±å“ã€‚

---

### æ­¥éª¤ 8ï¼šç›¸å…³æ€§è¿‡æ»¤

**æ–‡ä»¶**ï¼š`src/strategy/correlation.ts`

å‡½æ•° `checkCorrelation(symbol, klines, heldMap, threshold)` ä½¿ç”¨ Pearson ç›¸å…³ç³»æ•°æ£€æµ‹æ–°ä¿¡å·ä¸å·²æŒä»“èµ„äº§çš„ç›¸å…³æ€§ã€‚

```
å¦‚æœ ç›¸å…³ç³»æ•° > thresholdï¼ˆé»˜è®¤ 0.75ï¼‰ï¼š
  â†’ ç¼©ä»“ 50%ï¼ˆä¸ç›´æ¥æ‹’ç»ï¼Œä»…ç¼©å‡ä»“ä½ï¼‰

å¦‚æœå·²æŒä»“å¤šä¸ªé«˜ç›¸å…³èµ„äº§ï¼š
  â†’ å¯èƒ½ç´¯è®¡ç¼©ä»“å¤šæ¬¡
```

é…ç½®é¡¹ï¼š
```yaml
correlation_filter:
  enabled: true
  threshold: 0.75   # çš®å°”é€Šç›¸å…³ç³»æ•°é˜ˆå€¼
  lookback: 60      # ç”¨æœ€è¿‘ 60 æ ¹ K çº¿è®¡ç®—
```

ç›¸å…³æ€§è¿‡æ»¤ä¸ Regime ç¼©ä»“æ˜¯å åŠ å…³ç³»ï¼ˆä¸¤è€…å‡è§¦å‘æ—¶ä»“ä½å¯èƒ½è¢«ç¼©è‡³åŸæ¥çš„ 25%ï¼‰ã€‚

---

### æ­¥éª¤ 9ï¼šProtection Manager

**æ–‡ä»¶**ï¼š`src/strategy/protection-manager.ts`

å‡½æ•° `checkProtections(symbol, protectionCfg, recentTrades, candleIntervalMs)` æä¾›ä¸‰ç§ä¿æŠ¤ï¼š

| ä¿æŠ¤ç±»å‹ | è¯´æ˜ | è§¦å‘ç»“æœ |
|---------|------|---------|
| `cooldown` | æœ€è¿‘ä¸€ç¬”äº¤æ˜“äºæŸåå†·å´ N æ ¹ K çº¿ | æ‹’ç»å¼€ä»“ |
| `stoploss_guard` | è¿‘ N ç¬”äºæŸå æ¯”è¶…è¿‡é˜ˆå€¼ | æ‹’ç»å¼€ä»“ |
| `max_drawdown` | å•å¸ç§æœ€å¤§å›æ’¤è¶…è¿‡é˜ˆå€¼ | æ‹’ç»å¼€ä»“ |

åœ¨ `processSignal()` ä¸­ä»…å¯¹ **å¼€ä»“ä¿¡å·** æ‰§è¡Œï¼Œéœ€ä¼ å…¥ `recentTrades`ï¼ˆå†å²å¹³ä»“è®°å½•ï¼‰ã€‚

---

### æ­¥éª¤ 10ï¼šç´§æ€¥æš‚åœ

**æ–‡ä»¶**ï¼š`src/news/emergency-monitor.ts`

```typescript
const emergencyState = readEmergencyHalt();
// emergencyState.halt === true â†’ åœæ­¢æ‰€æœ‰å¼€ä»“
```

ç´§æ€¥æš‚åœç”± `news_emergency` cronï¼ˆæ¯ 10 åˆ†é’Ÿï¼‰é€šè¿‡ `news/emergency-monitor.ts` æ£€æµ‹çªå‘é«˜å±æ–°é—»åè‡ªåŠ¨å†™å…¥çŠ¶æ€æ–‡ä»¶ã€‚**ä»…å½±å“å¼€ä»“ä¿¡å·**ï¼Œæ­¢æŸ/æ­¢ç›ˆå¹³ä»“ä¸å—å½±å“ã€‚

---

### æ­¥éª¤ 11ï¼šäº‹ä»¶æ—¥å†

**æ–‡ä»¶**ï¼š`src/strategy/events-calendar.ts`

å‡½æ•° `checkEventRisk(calendar)` æ£€æŸ¥å½“å‰æ˜¯å¦å¤„äºå®è§‚äº‹ä»¶çª—å£æœŸï¼š

| äº‹ä»¶é˜¶æ®µ | å«ä¹‰ | è¡Œä¸º |
|---------|------|------|
| `during` | æ­£åœ¨äº‹ä»¶çª—å£æœŸï¼ˆå¦‚ FOMC å‘å¸ƒï¼‰ | **æš‚åœ**æ‰€æœ‰å¼€ä»“ |
| `pre` | äº‹ä»¶å‰é¢„è­¦æœŸ | ä»“ä½ Ã— `positionRatioMultiplier`ï¼ˆæ—¥å¿—æç¤ºï¼‰ |
| `post` | äº‹ä»¶åè§‚å¯ŸæœŸ | ä»“ä½ Ã— `positionRatioMultiplier`ï¼ˆæ—¥å¿—æç¤ºï¼‰ |
| `none` | æ— äº‹ä»¶ | æ­£å¸¸æ‰§è¡Œ |

æ—¥å†æ–‡ä»¶é€šè¿‡å¤–éƒ¨é…ç½®ç»´æŠ¤ï¼Œ`loadCalendar()` ä»ç£ç›˜è¯»å–ã€‚

---

### æ­¥éª¤ 12ï¼šMTF è¶‹åŠ¿è¿‡æ»¤

**æ–‡ä»¶**ï¼š`src/monitor.ts`ã€`src/scripts/live-monitor.ts`

MTFï¼ˆå¤šæ—¶é—´æ¡†æ¶ï¼‰è¿‡æ»¤åœ¨ `processSignal()` ä¹‹å¤–ã€æ‰§è¡Œä¹‹å‰ï¼Œåœ¨å„ç®¡çº¿è„šæœ¬ä¸­ç‹¬ç«‹å®ç°ï¼š

```
é…ç½®ï¼štrend_timeframe = "4h"ï¼ˆ4 å°æ—¶å¤§è¶‹åŠ¿ï¼‰

æ‹‰å– 4h K çº¿ â†’ calculateIndicators() â†’ åˆ¤æ–­ EMA20 vs EMA60

ä¹°å…¥ä¿¡å·ï¼ˆbuyï¼‰  + 4h ç©ºå¤´ï¼ˆEMA20 < EMA60ï¼‰â†’ ğŸš« è·³è¿‡
å¼€ç©ºä¿¡å·ï¼ˆshortï¼‰+ 4h å¤šå¤´ï¼ˆEMA20 > EMA60ï¼‰â†’ ğŸš« è·³è¿‡
å¹³ä»“ä¿¡å·ï¼ˆsell/coverï¼‰â†’ ä¸å— MTF é™åˆ¶
```

> âš ï¸ **æ³¨æ„**ï¼šMTF è¿‡æ»¤ä»£ç åœ¨ `monitor.ts` å’Œ `live-monitor.ts` ä¸­åˆ†åˆ«å®ç°ï¼Œ**æœªé€šè¿‡ `processSignal()` ç»Ÿä¸€**ã€‚è¿™æ˜¯å·²çŸ¥çš„ä»£ç é‡å¤é—®é¢˜ï¼Œè¯¦è§ã€Œå®¡è®¡å‘ç°ã€ç« èŠ‚ã€‚

---

### æ­¥éª¤ 13ï¼šæƒ…ç»ªé—¨æ§

**æ–‡ä»¶**ï¼š`src/news/sentiment-gate.ts`ã€`src/news/sentiment-cache.ts`

```typescript
const newsReport = loadNewsReport();      // æœ€æ–°æ–°é—»æŠ¥å‘Šï¼ˆæ¯4å°æ—¶é‡‡é›†ï¼‰
const sentimentCache = readSentimentCache(); // LLMæƒ…ç»ªç¼“å­˜ï¼ˆå…³é”®è¯å»é‡ï¼‰
const gate = evaluateSentimentGate(signal, newsReport, baseForGate, sentimentCache);
```

`gate.action` å–å€¼ï¼š
- `"proceed"`ï¼šæ­£å¸¸æ‰§è¡Œï¼Œä»“ä½æ¯”ä¾‹ = `gate.positionRatio`
- `"reduce"`ï¼šå‡ä»“æ‰§è¡Œï¼Œä»“ä½æ¯”ä¾‹é™ä½
- `"skip"`ï¼šè·³è¿‡æœ¬æ¬¡ä¿¡å·

æƒ…ç»ªé—¨æ§ä»¥ã€Œç»„åˆè°ƒæ•´åçš„ä»“ä½æ¯”ä¾‹ã€ä¸ºåŸºå‡†ï¼ˆRegime + ç›¸å…³æ€§è°ƒæ•´ä¹‹åçš„å€¼ï¼‰ï¼Œå¯ä»¥å†æ¬¡ç¼©å‡ã€‚

**ä¾èµ–å…³ç³»**ï¼šæƒ…ç»ªé—¨æ§éœ€è¦æ–°é—»é‡‡é›† cronï¼ˆ`news/monitor.ts`ï¼Œæ¯ 4 å°æ—¶ï¼‰æå‰è¿è¡Œï¼Œå°†æŠ¥å‘Šå†™å…¥ç£ç›˜ã€‚

---

### æ­¥éª¤ 14ï¼šKelly ä»“ä½

**æ–‡ä»¶**ï¼š`src/strategy/kelly.ts`

å‡½æ•° `calcKellyRatio(closedTrades, options)` ä½¿ç”¨ Kelly å…¬å¼åŠ¨æ€è®¡ç®—æœ€ä¼˜ä»“ä½æ¯”ä¾‹ï¼š

```
Kelly = W - (1-W)/R
åŠ Kelly = Kelly Ã— 0.5
```

å…¶ä¸­ï¼š
- `W`ï¼šå†å²èƒœç‡
- `R`ï¼šå¹³å‡ç›ˆäºæ¯”

é…ç½®é¡¹ï¼š
```yaml
position_sizing: "kelly"  # "fixed"ï¼ˆé»˜è®¤ï¼‰| "kelly"
kelly_lookback: 30        # å‚è€ƒæœ€è¿‘ 30 ç¬”å¹³ä»“
kelly_half: true          # åŠ Kellyï¼ˆé»˜è®¤ï¼Œé™ä½æ–¹å·®ï¼‰
kelly_min_ratio: 0.05     # ä»“ä½ä¸‹é™ 5%
kelly_max_ratio: 0.40     # ä»“ä½ä¸Šé™ 40%
```

**å¯ç”¨æ¡ä»¶**ï¼šéœ€è¦ **è‡³å°‘ 10 ç¬”å†å²å¹³ä»“è®°å½•**ï¼ˆ`calcKellyRatio` å†…éƒ¨å¼ºåˆ¶æ£€æŸ¥ï¼‰ï¼Œå¦åˆ™å›é€€åˆ° `fallback` å›ºå®šä»“ä½ã€‚

> â³ **å½“å‰çŠ¶æ€**ï¼štestnet-default åœºæ™¯ `position_sizing` ä¸º `"fixed"`ï¼ŒKelly ä»“ä½**å°šæœªå¯ç”¨**ï¼Œç­‰å¾…ç§¯ç´¯ 30+ ç¬”å†å²åå†åˆ‡æ¢ã€‚

---

### æ­¥éª¤ 15ï¼šæ‰§è¡Œ

**æ–‡ä»¶**ï¼š`src/paper/engine.ts`ï¼ˆPaperï¼‰ã€`src/live/executor.ts`ï¼ˆLiveï¼‰

è°ƒç”¨ `handleSignal(signal, cfg)` è¿›å…¥æ‰§è¡Œå¼•æ“ï¼ˆè¯¦è§ç¬¬ 4 ç« ï¼‰ã€‚

---

## 4. æ‰§è¡Œå¼•æ“è¯¦è§£

### 4.1 Paper Engineï¼ˆæ¨¡æ‹Ÿå¼•æ“ï¼‰

**æ–‡ä»¶**ï¼š`src/paper/engine.ts`

Paper Engine æ¨¡æ‹ŸçœŸå®äº¤æ˜“æµç¨‹ï¼Œæ‰€æœ‰çŠ¶æ€å­˜å…¥æœ¬åœ° JSON æ–‡ä»¶ã€‚

#### 4.1.1 å¼€ä»“æµç¨‹

```
handleSignal(signal, cfg)
  â”‚
  â”œâ”€ buy ä¿¡å·
  â”‚    â”œâ”€ æ£€æŸ¥ max_positionsï¼ˆè¶…å‡º â†’ skipï¼‰
  â”‚    â”œâ”€ æ£€æŸ¥è´¦æˆ·å‡€å€¼ï¼ˆâ‰¤0 â†’ skipï¼‰
  â”‚    â”œâ”€ æ£€æŸ¥å•å¸å æ¯” max_position_per_symbol
  â”‚    â”œâ”€ æ£€æŸ¥æ¯æ—¥äºæŸ daily_loss_limit_percent
  â”‚    â”œâ”€ ATR åŠ¨æ€ä»“ä½è®¡ç®—ï¼ˆcalcAtrPositionSizeï¼‰
  â”‚    â””â”€ paperBuy() â†’ æ›´æ–°è´¦æˆ· positions
  â”‚
  â”œâ”€ short ä¿¡å·
  â”‚    â”œâ”€ æ£€æŸ¥å¸‚åœºç±»å‹ï¼ˆspot â†’ skipï¼Œä»… futures/margin æœ‰æ•ˆï¼‰
  â”‚    â”œâ”€ ï¼ˆåŒ buy çš„ max_positions / å‡€å€¼ / å•å¸å æ¯” / æ—¥äºæŸæ£€æŸ¥ï¼‰
  â”‚    â”œâ”€ ATR åŠ¨æ€ä»“ä½è®¡ç®—
  â”‚    â””â”€ paperOpenShort() â†’ æ›´æ–°è´¦æˆ· positions
  â”‚
  â”œâ”€ sell ä¿¡å· â†’ paperSell()
  â””â”€ cover ä¿¡å· â†’ paperCoverShort()
```

#### 4.1.2 å‡ºåœºæµç¨‹

`checkExitConditions()` æ¯åˆ†é’Ÿéå†æ‰€æœ‰æŒä»“ï¼ŒæŒ‰ä»¥ä¸‹**ä¼˜å…ˆçº§é¡ºåº**æ£€æŸ¥ï¼š

```
å‡ºåœºä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
  1. force_exit_timeout   è¶…æ—¶å‡ºåœºï¼ˆexitTimeoutCount â‰¥ 3 â†’ å¼ºåˆ¶å¸‚ä»·ï¼‰
  2. stop_loss            æ­¢æŸè§¦å‘
  3. ROI Table            æ—¶é—´è¡°å‡æ­¢ç›ˆï¼ˆcheckMinimalRoiï¼‰
  4. take_profit          å›ºå®šæ­¢ç›ˆ
  5. trailing_stop        è¿½è¸ªæ­¢æŸï¼ˆupdateTrailingStopï¼‰
  6. time_stop            æ—¶é—´æ­¢æŸï¼ˆæŒä»“ > time_stop_hours ä¸”æ— ç›ˆåˆ©ï¼‰
  7. staged_TP            åˆ†æ‰¹æ­¢ç›ˆï¼ˆcheckStagedTakeProfitï¼Œå¹¶è¡Œæ£€æŸ¥ï¼‰
```

#### 4.1.3 ä¿æœ¬æ­¢æŸï¼ˆBreak-Even Stopï¼‰

**æ–‡ä»¶**ï¼š`src/strategy/break-even.ts`

å‡½æ•° `resolveNewStopLoss()` åœ¨æ¯æ¬¡æ£€æŸ¥å‡ºåœºæ¡ä»¶å‰è°ƒç”¨ï¼Œå½“ç›ˆåˆ©è¾¾åˆ° `break_even_profit` é˜ˆå€¼åï¼Œå°†æ­¢æŸçº¿ä¸Šç§»è‡³ `å…¥åœºä»· + break_even_stop`ï¼š

```yaml
break_even_profit: 0.03   # ç›ˆåˆ© â‰¥ 3% åæ¿€æ´»
break_even_stop: 0.001    # æ­¢æŸçº¿ç§»è‡³å…¥åœºä»· +0.1%
```

#### 4.1.4 å‡ºåœºç¡®è®¤ï¼ˆconfirm_trade_exitï¼‰

**æ–‡ä»¶**ï¼š`src/strategy/confirm-exit.ts`

`shouldConfirmExit()` æä¾›å¯é€‰çš„å‡ºåœºç¡®è®¤æœºåˆ¶ï¼Œé¿å…å› çŸ­æš‚æ³¢åŠ¨è¯¯è§¦å‡ºåœºã€‚å·²å®ç°ä½†éœ€é…ç½® `confirm_trade_exit` å¯ç”¨ã€‚

### 4.2 Live Executorï¼ˆå®ç›˜æ‰§è¡Œå™¨ï¼‰

**æ–‡ä»¶**ï¼š`src/live/executor.ts`

Live Executor é€šè¿‡ Binance çœŸå® API ä¸‹å•ã€‚

```typescript
const executor = createLiveExecutor(cfg);
// æ‰§è¡Œå¼€ä»“
await executor.openPosition(signal, adjustedCfg);
// æ‰§è¡Œå¹³ä»“
await executor.closePosition(symbol, reason, cfg);
```

Testnet æ¨¡å¼ä¸‹é€šè¿‡ `exchange.testnet: true` è¿æ¥ `testapi.binance.vision`ã€‚

ä»“ä½åŒæ­¥ï¼š`reconcilePositions()` / `formatReconcileReport()` ç”¨äºå¯¹è´¦ API æŒä»“ä¸æœ¬åœ°è´¦æˆ·æ–‡ä»¶çš„å·®å¼‚ã€‚

---

## 5. é…ç½®ä½“ç³»

### 5.1 ä¸‰å±‚åˆå¹¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é…ç½®ä¼˜å…ˆçº§ï¼ˆä»ä½åˆ°é«˜ï¼‰                       â”‚
â”‚                                                             â”‚
â”‚  ç¬¬ 1 å±‚ï¼šconfig/strategy.yamlï¼ˆå…¨å±€é»˜è®¤ï¼‰                    â”‚
â”‚    â””â”€â”€ å…¨å±€æŒ‡æ ‡å‚æ•°ã€ä¿¡å·æ¡ä»¶ã€é£æ§åŸºå‡†ã€cron è®¡åˆ’              â”‚
â”‚                                                             â”‚
â”‚  ç¬¬ 2 å±‚ï¼šconfig/strategies/{strategy_id}.yamlï¼ˆç­–ç•¥ profileï¼‰â”‚
â”‚    â””â”€â”€ è¦†ç›–ï¼šsignals, strategy, risk, timeframe              â”‚
â”‚                                                             â”‚
â”‚  ç¬¬ 3 å±‚ï¼šconfig/paper.yaml â†’ scenarios[n]ï¼ˆåœºæ™¯è¦†ç›–ï¼‰        â”‚
â”‚    â””â”€â”€ è¦†ç›–ï¼šrisk, symbols, exchange, initial_usdt ç­‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–‡ä»¶**ï¼š`src/config/loader.ts`

åˆå¹¶å‡½æ•°ï¼š
- `mergeRisk(base, ...overrides)` â€” æ·±åˆå¹¶ `RiskConfig`ï¼ŒåµŒå¥—å¯¹è±¡ï¼ˆ`trailing_stop`, `atr_position`, `correlation_filter`ï¼‰é€å­—æ®µåˆå¹¶ï¼Œä¸ä¼šå› éƒ¨åˆ†è¦†ç›–ä¸¢å¤±åŸºç¡€é…ç½®
- `mergeStrategySection(base, override)` â€” æ·±åˆå¹¶ `strategy`ï¼ˆ`ma`, `rsi`, `macd`, `volume`ï¼‰

æ„å»ºå‡½æ•°ï¼š
- `buildPaperRuntime(base, paperCfg, scenario)` â€” ä¸ºå•ä¸ªåœºæ™¯æ„å»º `RuntimeConfig`
- `loadRuntimeConfigs()` â€” åŠ è½½æ‰€æœ‰ `enabled` åœºæ™¯

### 5.2 testnet-default åœºæ™¯å®Œæ•´é…ç½®

```yaml
# config/paper.yaml â†’ scenarios â†’ testnet-default
id: "testnet-default"
name: "Testnet Ã— é»˜è®¤ç­–ç•¥"
enabled: true
strategy_id: "long-short"    # ä½¿ç”¨ config/strategies/long-short.yaml
initial_usdt: 10000
fee_rate: 0.001
slippage_percent: 0.05

exchange:
  market: "spot"
  testnet: true
  credentials_path: ".secrets/binance-testnet.json"
  leverage:
    enabled: false
    default: 1
    max: 1

risk:
  stop_loss_percent: 5
  take_profit_percent: 15
  trailing_stop:
    enabled: true
    activation_percent: 8
    callback_percent: 2
  position_ratio: 0.2         # fallbackä»“ä½
  max_positions: 3
  max_position_per_symbol: 0.3
  max_total_loss_percent: 20
  daily_loss_limit_percent: 8
  atr_position:
    enabled: true
    risk_per_trade_percent: 2
    atr_multiplier: 1.5
    max_position_ratio: 0.3
  take_profit_stages:         # åˆ†æ‰¹æ­¢ç›ˆ
    - at_percent: 8
      close_ratio: 0.5
    - at_percent: 12
      close_ratio: 0.5
  time_stop_hours: 72
  break_even_profit: 0.03
  break_even_stop: 0.001
```

åˆå¹¶å `RuntimeConfig` å…³é”®å­—æ®µï¼ˆæ¥è‡ª strategy.yaml + long-short.yaml + testnet-defaultï¼‰ï¼š

| å­—æ®µ | å€¼ | æ¥æº |
|------|-----|------|
| `timeframe` | `"1h"` | long-short.yaml |
| `trend_timeframe` | `"4h"` | long-short.yaml |
| `strategy.ma.short/long` | `20 / 60` | ä¸¤å±‚ä¸€è‡´ |
| `strategy.rsi.oversold/overbought` | `35 / 65` | long-short.yamlï¼ˆè¦†ç›–å…¨å±€ 30/65ï¼‰|
| `signals.buy` | `ma_bullish + macd_golden_cross + rsi_not_overbought` | long-short.yaml |
| `signals.short` | `ma_bearish + macd_death_cross + rsi_not_oversold` | long-short.yaml |
| `risk.min_rr` | `1.5` | strategy.yamlï¼ˆå…¨å±€ï¼‰|
| `risk.correlation_filter.enabled` | `true` | strategy.yamlï¼ˆå…¨å±€ï¼‰|

---

## 6. æ•°æ®æµä¸å­˜å‚¨

### 6.1 æ–‡ä»¶å­˜å‚¨æ€»è§ˆ

```
logs/
â”œâ”€â”€ paper-{scenarioId}.json        # è´¦æˆ·æ–‡ä»¶ï¼ˆåŸå­å†™å…¥ï¼‰
â”œâ”€â”€ signal-history.jsonl           # ä¿¡å·å†å²ï¼ˆJSONL è¿½åŠ ï¼‰
â”œâ”€â”€ signal-notify-dedup.json       # é€šçŸ¥å»é‡çŠ¶æ€
â”œâ”€â”€ state-{scenarioId}.json        # Monitor çŠ¶æ€ï¼ˆä¸Šæ¬¡ä¿¡å· + æ—¶é—´æˆ³ï¼‰
â”œâ”€â”€ monitor.log                    # Cron ç›‘æ§æ—¥å¿—
â”œâ”€â”€ health/
â”‚   â”œâ”€â”€ heartbeat-{scenarioId}.json  # å¥åº·å¿ƒè·³
â”‚   â””â”€â”€ ...
â”œâ”€â”€ backtest/
â”‚   â””â”€â”€ report-{timestamp}.json    # å›æµ‹æŠ¥å‘Š
â””â”€â”€ trades-{scenarioId}.db         # SQLite äº¤æ˜“è®°å½•ï¼ˆG5ï¼Œå¯é€‰ï¼‰
```

### 6.2 è´¦æˆ·æ–‡ä»¶ç»“æ„

**æ–‡ä»¶**ï¼š`logs/paper-{scenarioId}.json`ï¼ˆé€šè¿‡ `src/paper/account.ts` ç®¡ç†ï¼‰

```json
{
  "balance": 9500.0,
  "positions": {
    "BTCUSDT": {
      "symbol": "BTCUSDT",
      "side": "long",
      "quantity": 0.001,
      "entryPrice": 42000,
      "entryTime": 1700000000000,
      "stopLoss": 39900,
      "takeProfit": 48300,
      "signalHistoryId": "sig_xxxx",
      "tpStages": [...],
      "dcaState": null
    }
  },
  "trades": [...],
  "dailyLoss": { "date": "2026-02-26", "loss": 0 }
}
```

åŸå­å†™å…¥ï¼šå…ˆå†™ä¸´æ—¶æ–‡ä»¶ï¼Œå† `fs.renameSync()` æ›¿æ¢ï¼Œé¿å…å†™å…¥ä¸­æ–­å¯¼è‡´æ–‡ä»¶æŸåã€‚

### 6.3 ä¿¡å·å†å²

**æ–‡ä»¶**ï¼š`logs/signal-history.jsonl`

æ¯ç¬”ä¿¡å·ä¸€è¡Œ JSONï¼Œé€šè¿‡ `src/strategy/signal-history.ts` ç®¡ç†ï¼š
- `logSignal()` â€” å¼€ä»“æ—¶å†™å…¥ï¼ˆstatus: "open"ï¼‰
- `closeSignal(id, exitPrice, reason, pnl)` â€” å¹³ä»“æ—¶æ›´æ–°ï¼ˆstatus: "closed"ï¼‰

Kelly ä»“ä½è®¡ç®—è¯»å–æ­¤æ–‡ä»¶çš„ `status === "closed"` è®°å½•ã€‚

### 6.4 é€šçŸ¥å»é‡

**æ–‡ä»¶**ï¼š`logs/signal-notify-dedup.json`ï¼ˆé€šè¿‡ `monitor.ts` ä¸­ `state.lastSignals` ç®¡ç†ï¼‰

æ¯ä¸ª symbol è®°å½•ä¸Šæ¬¡é€šçŸ¥çš„ä¿¡å·ç±»å‹å’Œæ—¶é—´æˆ³ï¼Œ`shouldNotify()` åŸºäº `min_interval_minutes`ï¼ˆé»˜è®¤ 30 åˆ†é’Ÿï¼‰åˆ¤æ–­æ˜¯å¦éœ€è¦å†æ¬¡é€šçŸ¥ã€‚

---

## 7. å®šæ—¶ä»»åŠ¡ä½“ç³»

### 7.1 Cron ä»»åŠ¡åˆ—è¡¨

**é…ç½®**ï¼š`config/strategy.yaml â†’ schedule`
**åŒæ­¥è„šæœ¬**ï¼š`src/scripts/sync-cron.ts`ï¼ˆ`npm run cron:sync` å†™å…¥ç³»ç»Ÿ crontabï¼‰

| ä»»åŠ¡ | Cron è¡¨è¾¾å¼ | è„šæœ¬è·¯å¾„ | è¶…æ—¶ | çŠ¶æ€ |
|------|------------|----------|------|------|
| ä»·æ ¼ç›‘æ§ | `* * * * *`ï¼ˆæ¯åˆ†é’Ÿï¼‰| `src/monitor.ts` | 3 åˆ†é’Ÿ | âœ… |
| æ–°é—»é‡‡é›† | `0 */4 * * *`ï¼ˆæ¯ 4 å°æ—¶ï¼‰| `src/news/monitor.ts` | 260 åˆ†é’Ÿ | âœ… |
| å‘¨æŠ¥ | `0 14 * * 0`ï¼ˆå‘¨æ—¥ 22:00 CSTï¼‰| `src/report/weekly.ts` | 10 åˆ†é’Ÿ | âœ… |
| å¥åº·æ£€æŸ¥ | `*/30 * * * *`ï¼ˆæ¯ 30 åˆ†é’Ÿï¼‰| `src/health/checker.ts` | 35 åˆ†é’Ÿ | âœ… |
| Watchdog | `*/5 * * * *`ï¼ˆæ¯ 5 åˆ†é’Ÿï¼‰| `src/health/watchdog.ts` | 10 åˆ†é’Ÿ | âœ… |
| æ—¥å¿—è½®è½¬ | `0 0 * * *`ï¼ˆæ¯æ—¥ 0 ç‚¹ï¼‰| `src/health/log-rotate.ts` | 10 åˆ†é’Ÿ | âœ… |
| ç´§æ€¥æ–°é—» | `*/10 * * * *`ï¼ˆæ¯ 10 åˆ†é’Ÿï¼‰| `src/news/emergency-monitor.ts` | 5 åˆ†é’Ÿ | âœ… |
| å¸ç§åˆ·æ–° | `0 0 * * *`ï¼ˆæ¯æ—¥ 0 ç‚¹ï¼‰| `src/scripts/refresh-pairlist.ts` | 5 åˆ†é’Ÿ | âœ… |

### 7.2 å¸¸é©»è¿›ç¨‹

| è¿›ç¨‹ | tmux session | å‘½ä»¤ | çŠ¶æ€ |
|------|-------------|------|------|
| Live Monitor | `trader-live` | `npm run live` | âœ… è¿è¡Œä¸­ |

é‡å¯å‘½ä»¤ï¼š
```bash
tmux send-keys -t trader-live C-c
sleep 2
tmux send-keys -t trader-live "npm run live" Enter
```

### 7.3 ä»»åŠ¡ä¾èµ–å…³ç³»

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚          ä»»åŠ¡ä¾èµ–é“¾                    â”‚
                        â”‚                                     â”‚
  news/monitor.ts â”€â”€â”€â”€â”€â†’â”‚ å†™å…¥æ–°é—»æŠ¥å‘Š                         â”‚
  ï¼ˆæ¯4å°æ—¶ï¼‰             â”‚ logs/news-report-*.json              â”‚
                        â”‚          â†“                          â”‚
  news/emergency-monitorâ†’â”‚ æ£€æµ‹é«˜å±æ–°é—» â†’ emergency halt æ–‡ä»¶    â”‚
  ï¼ˆæ¯10åˆ†é’Ÿï¼‰            â”‚          â†“                          â”‚
                        â”‚ monitor.ts / live-monitor.ts         â”‚
                        â”‚   â””â”€ readEmergencyHalt() è¯»å–         â”‚
                        â”‚   â””â”€ loadNewsReport() è¯»å–            â”‚
                        â”‚   â””â”€ readSentimentCache() è¯»å–        â”‚
                        â”‚          â†“                          â”‚
                        â”‚ evaluateSentimentGate() æ‰§è¡Œæƒ…ç»ªé—¨æ§  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  health/watchdog.ts â”€â”€â†’ æ£€æŸ¥ monitor.ts ä¸Šæ¬¡è¿è¡Œæ—¶é—´
  ï¼ˆæ¯5åˆ†é’Ÿï¼‰              â†’ è¶…æ—¶æœªè¿è¡Œ â†’ Telegram å‘Šè­¦

  health/checker.ts â”€â”€â”€â†’ æ£€æŸ¥è´¦æˆ·çŠ¶æ€ / ç³»ç»Ÿå¥åº·
  ï¼ˆæ¯30åˆ†é’Ÿï¼‰             â†’ å†™å…¥ logs/health/ å¿ƒè·³æ–‡ä»¶
```

**å…³é”®ä¾èµ–**ï¼šæƒ…ç»ªé—¨æ§ï¼ˆæ­¥éª¤ 13ï¼‰ä¾èµ–æ–°é—»é‡‡é›† cron å®šæœŸè¿è¡Œã€‚è‹¥æ–°é—»é‡‡é›†åœæ­¢ï¼Œ`loadNewsReport()` å°†è¯»å–æ—§æŠ¥å‘Šï¼Œæƒ…ç»ªé—¨æ§å¯èƒ½åŸºäºè¿‡æœŸæ•°æ®åšå†³ç­–ã€‚

---

## 8. é£æ§ä½“ç³»

### 8.1 é£æ§å±‚çº§æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é£æ§å±‚çº§                                  â”‚
â”‚                                                              â”‚
â”‚  å•ç¬”äº¤æ˜“å±‚ï¼ˆper-tradeï¼‰                                       â”‚
â”‚  â”œâ”€â”€ æ­¢æŸï¼ˆStop Lossï¼‰ï¼š- stop_loss_percent = 5%              â”‚
â”‚  â”œâ”€â”€ æ­¢ç›ˆï¼ˆTake Profitï¼‰ï¼štake_profit_percent = 15%           â”‚
â”‚  â”œâ”€â”€ åˆ†æ‰¹æ­¢ç›ˆï¼ˆStaged TPï¼‰ï¼š8%/50% â†’ 12%/50%                  â”‚
â”‚  â”œâ”€â”€ è¿½è¸ªæ­¢æŸï¼ˆTrailing Stopï¼‰ï¼šæ¿€æ´» 8%ï¼Œå›è°ƒ 2%               â”‚
â”‚  â”œâ”€â”€ æ—¶é—´æ­¢æŸï¼ˆTime Stopï¼‰ï¼š72 å°æ—¶æ— ç›ˆåˆ©å¼ºåˆ¶å‡ºåœº               â”‚
â”‚  â”œâ”€â”€ ä¿æœ¬æ­¢æŸï¼ˆBreak-Evenï¼‰ï¼šç›ˆåˆ© 3% â†’ æ­¢æŸç§»è‡³ +0.1%          â”‚
â”‚  â””â”€â”€ R:R è¿‡æ»¤ï¼šç›ˆäºæ¯” â‰¥ 1.5 æ‰å…¥åœº                           â”‚
â”‚                                                              â”‚
â”‚  ç»„åˆå±‚ï¼ˆportfolioï¼‰                                           â”‚
â”‚  â”œâ”€â”€ æœ€å¤§æŒä»“æ•°ï¼šmax_positions = 3                             â”‚
â”‚  â”œâ”€â”€ å•å¸å æ¯”ï¼šmax_position_per_symbol = 30%                  â”‚
â”‚  â””â”€â”€ ç›¸å…³æ€§è¿‡æ»¤ï¼šé«˜ç›¸å…³ï¼ˆ>0.75ï¼‰ç¼©ä»“ 50%                        â”‚
â”‚                                                              â”‚
â”‚  æ¯æ—¥å±‚ï¼ˆdailyï¼‰                                              â”‚
â”‚  â””â”€â”€ æ¯æ—¥äºæŸé™åˆ¶ï¼šdaily_loss_limit_percent = 8%              â”‚
â”‚                                                              â”‚
â”‚  å…¨å±€å±‚ï¼ˆglobalï¼‰                                             â”‚
â”‚  â”œâ”€â”€ æ€»äºæŸä¸Šé™ï¼šmax_total_loss_percent = 20%                 â”‚
â”‚  â”œâ”€â”€ Kill Switchï¼šè‡ªåŠ¨è§¦å‘ï¼Œåœæ­¢æ‰€æœ‰æ–°å¼€ä»“                       â”‚
â”‚  â”œâ”€â”€ ç´§æ€¥æš‚åœï¼šçªå‘æ–°é—»è§¦å‘ï¼ŒreadEmergencyHalt()               â”‚
â”‚  â””â”€â”€ BTC å´©ç›˜æ£€æµ‹ï¼š1h è·Œå¹… > 8% â†’ activateKillSwitch()       â”‚
â”‚                                                              â”‚
â”‚  ä»“ä½å±‚ï¼ˆposition sizingï¼‰                                     â”‚
â”‚  â”œâ”€â”€ ATR åŠ¨æ€ä»“ä½ï¼šrisk_per_trade=2%, ATRÃ—1.5 ä¸ºæ­¢æŸè·ç¦»       â”‚
â”‚  â”œâ”€â”€ Kelly åŠ¨æ€ï¼ˆå¾…å¯ç”¨ï¼‰ï¼šåŠ Kellyï¼Œ10 ç¬”ä»¥ä¸Šå†å²              â”‚
â”‚  â”œâ”€â”€ Regime ç¼©å‡ï¼šå¸‚åœºå¼‚å¸¸æ—¶ä»“ä½ Ã— 0.5                         â”‚
â”‚  â”œâ”€â”€ ç›¸å…³æ€§ç¼©å‡ï¼šé«˜ç›¸å…³æ—¶ä»“ä½ Ã— 0.5                             â”‚
â”‚  â””â”€â”€ äº‹ä»¶ä¹˜æ•°ï¼šäº‹ä»¶å‰/å Ã— positionRatioMultiplier             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ä»“ä½è®¡ç®—è¯¦è§£

å½“ `atr_position.enabled = true` æ—¶ï¼ŒATR åŠ¨æ€ä»“ä½ä¼˜å…ˆäºå›ºå®š `position_ratio`ï¼š

```
ä»“ä½ USDT = (è´¦æˆ·å‡€å€¼ Ã— risk_per_trade_percent) / (ATR Ã— atr_multiplier / ä»·æ ¼)

ä¾‹ï¼š
  å‡€å€¼ = 10,000 USDT
  risk_per_trade = 2% = 200 USDT
  ATR = 500 USDT
  atr_multiplier = 1.5 â†’ æ­¢æŸè·ç¦» = 750 USDT
  ä»“ä½ = 200 / (750/ä»·æ ¼) â‰ˆ å–å†³äºå½“å‰ä»·æ ¼
```

`calcAtrPositionSize()` å®šä¹‰åœ¨ `src/strategy/indicators.ts`ï¼Œå— `max_position_ratio = 0.3` ä¸Šé™çº¦æŸã€‚

### 8.3 Kill Switch

**æ–‡ä»¶**ï¼š`src/health/kill-switch.ts`

è§¦å‘æ¡ä»¶ï¼š
- BTC 1 å°æ—¶å†…è·Œå¹… > `BTC_CRASH_THRESHOLD_PCT`ï¼ˆé»˜è®¤ 8%ï¼‰â†’ `checkBtcCrash()` è‡ªåŠ¨è§¦å‘
- æ‰‹åŠ¨ï¼š`src/scripts/kill-switch-cli.ts`

æ¿€æ´»åï¼š`isKillSwitchActive()` è¿”å› `true`ï¼Œæ‰€æœ‰ç®¡çº¿è·³è¿‡æ–°å¼€ä»“ã€‚

---

## 9. è¾…åŠ©å·¥å…·

### 9.1 å›æµ‹ç³»ç»Ÿ

**æ–‡ä»¶**ï¼š`src/backtest/runner.ts`ï¼ˆé€šè¿‡ `src/scripts/backtest.ts` è°ƒç”¨ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| å†å² K çº¿å›æµ‹ | âœ… ç»å¸¸ä½¿ç”¨ |
| è°ƒç”¨ `processSignal()` ç»Ÿä¸€å¼•æ“ | âœ… ä¸å®ç›˜ä¸€è‡´ |
| è¾“å‡ºå›æµ‹æŠ¥å‘Šåˆ° `logs/backtest/` | âœ… |
| æ‰‹ç»­è´¹/æ»‘ç‚¹æ¨¡æ‹Ÿ | âœ… |

### 9.2 Hyperopt è¶…å‚æ•°ä¼˜åŒ–

**æ–‡ä»¶**ï¼š`src/optimization/bayesian.ts`ï¼ˆé€šè¿‡ `src/scripts/hyperopt.ts` è°ƒç”¨ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| è´å¶æ–¯ä¼˜åŒ–æœç´¢æœ€ä¼˜å‚æ•° | âœ… 2026-02-26 ä½¿ç”¨ |
| å‚æ•°ç©ºé—´ï¼šMA/RSI/MACD/SL/TP ç­‰ | âœ… |
| è¾“å‡ºæœ€ä¼˜å‚æ•°åˆ°é…ç½® | â³ éœ€æ‰‹åŠ¨æ›´æ–° |

### 9.3 Walk-Forward åˆ†æ

**æ–‡ä»¶**ï¼š`src/optimization/auto-wf.ts`ï¼ˆé€šè¿‡ `src/scripts/auto-wf.ts` è°ƒç”¨ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| è‡ªåŠ¨æ»šåŠ¨çª—å£åˆ†æï¼ˆè®­ç»ƒ + éªŒè¯ï¼‰ | âŒ æœªå®šæœŸè¿è¡Œ |
| é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œæ£€éªŒå‚æ•°ç¨³å¥æ€§ | âœ… å·²å®ç° |

### 9.4 ä¿¡å·ç»Ÿè®¡åˆ†æ

**æ–‡ä»¶**ï¼š`src/analysis/signal-stats.ts`ï¼ˆé€šè¿‡ `src/scripts/signal-stats.ts` è°ƒç”¨ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| åˆ†æ signal-history.jsonl ç»Ÿè®¡èƒœç‡/ç›ˆäºæ¯” | â³ å¾…ç§¯ç´¯è¶³å¤Ÿæ•°æ® |
| åˆ†æ¡ä»¶ç»Ÿè®¡ï¼ˆMA/RSI/MACD å„æ¡ä»¶èƒœç‡ï¼‰| âœ… å·²å®ç° |

### 9.5 å‘¨æŠ¥

**æ–‡ä»¶**ï¼š`src/report/weekly.ts`ï¼ˆé€šè¿‡ `src/scripts/weekly-report.ts` è°ƒç”¨ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| æ¯å‘¨æ—¥ 22:00 CST è‡ªåŠ¨ç”Ÿæˆ | âœ… cron å·²è®¾ç½® |
| ç»Ÿè®¡æ”¶ç›Šã€èƒœç‡ã€æœ€å¤§å›æ’¤ | âœ… |
| å‘é€ Telegram é€šçŸ¥ | âœ… |

### 9.6 Telegram å‘½ä»¤äº¤äº’

**æ–‡ä»¶**ï¼š`src/telegram/command-handler.ts`ï¼ˆé€šè¿‡ `src/scripts/telegram-bot.ts` å¯åŠ¨ï¼‰

| å‘½ä»¤ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|
| `/status` | æŸ¥çœ‹è´¦æˆ·çŠ¶æ€ | âœ… å·²å®ç° |
| `/positions` | æŸ¥çœ‹å½“å‰æŒä»“ | âœ… å·²å®ç° |
| `/pause` / `/resume` | æš‚åœ/æ¢å¤ç›‘æ§ | âœ… å·²å®ç° |
| `/halt` / `/resume-halt` | è§¦å‘/è§£é™¤ç´§æ€¥æš‚åœ | âœ… å·²å®ç° |

> âŒ **å½“å‰çŠ¶æ€**ï¼šTelegram Bot å°šæœªä½œä¸ºç‹¬ç«‹è¿›ç¨‹å¯åŠ¨ï¼ˆ`npm run telegram-bot` æœªè¿è¡Œï¼‰ã€‚

### 9.7 Web ä»ªè¡¨ç›˜

**æ–‡ä»¶**ï¼š`src/web/dashboard-server.ts`ï¼ˆé€šè¿‡ `src/scripts/dashboard.ts` å¯åŠ¨ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| å®æ—¶è´¦æˆ·çŠ¶æ€ Web UI | âŒ æœªå¯åŠ¨ |
| REST API æ¥å£ | âœ… å·²å®ç° |

### 9.8 å…¶ä»–è„šæœ¬å·¥å…·

| å·¥å…· | æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|------|
| å¸‚åœºåˆ†æ | `scripts/market-analysis.ts` | 09:00/21:00 æ‰‹åŠ¨åˆ†æ | âœ… æ¯æ—¥ä½¿ç”¨ |
| æ‰‹åŠ¨äº¤æ˜“ | `scripts/mia-trade.ts` | æ‰‹åŠ¨å¼€å¹³ä»“å·¥å…· | âœ… æŒ‰éœ€ä½¿ç”¨ |
| æ¼‚ç§»æ£€æµ‹ | `scripts/drift-monitor.ts` | æ£€æµ‹å®ç›˜ vs æ¨¡æ‹Ÿçš„æ‰§è¡Œåå·® | âŒ æœªå®šæœŸè¿è¡Œ |
| å‘¨æœŸåˆ†æ | `scripts/cycle-analysis.ts` | åˆ†æ®µå‘¨æœŸå›æµ‹ | âœ… 2026-02-26 ä½¿ç”¨ |
| Regime å›æµ‹ | `scripts/regime-backtest.ts` | è‡ªé€‚åº”å›æµ‹éªŒè¯ | âœ… 2026-02-26 ä½¿ç”¨ |
| ä¿¡å·å½’å›  | `scripts/signal-attribution.ts` | åˆ†æå„æ¡ä»¶å¯¹ç›ˆäºçš„è´¡çŒ® | âŒ æœªä½¿ç”¨ |
| WebSocket ç›‘æ§ | `scripts/ws-monitor.ts` | æ›¿ä»£è½®è¯¢çš„å®æ—¶ç›‘æ§ | âŒ æœªæ¥å…¥ |

---

## å®¡è®¡å‘ç°

> æœ¬ç« èŠ‚è®°å½•å¯¹ç…§ä»£ç å®¡æŸ¥å‘ç°çš„é—®é¢˜ã€ä¸ä¸€è‡´ç‚¹å’Œæ½œåœ¨é£é™©ã€‚
> æ ¼å¼ï¼šç¼–å· / ç±»å‹ / æè¿° / å½±å“ / å»ºè®®

---

### A-001 âœ… [å·²ä¿®å¤ 47f6366] MTF è¶‹åŠ¿è¿‡æ»¤ä»£ç é‡å¤ï¼Œéç»Ÿä¸€ç®¡çº¿

**ç±»å‹**ï¼šä»£ç é‡å¤ / ç»´æŠ¤é£é™©

**æè¿°**ï¼š
MTFï¼ˆå¤šæ—¶é—´æ¡†æ¶ï¼‰è¶‹åŠ¿è¿‡æ»¤é€»è¾‘åœ¨ `src/monitor.ts`ï¼ˆçº¦ L110-L140ï¼‰å’Œ `src/scripts/live-monitor.ts`ï¼ˆçº¦ L190-L215ï¼‰ä¸­åˆ†åˆ«å®ç°ï¼Œæ²¡æœ‰å¤ç”¨ `processSignal()` ç»Ÿä¸€ç®¡çº¿ã€‚ä¸¤å¤„ä»£ç å½“å‰å†…å®¹ä¸€è‡´ï¼Œä½†æœªæ¥ä»»ä¸€ä¿®æ”¹æœªåŒæ­¥å°±ä¼šå¯¼è‡´è¡Œä¸ºå·®å¼‚ã€‚

**`MODULE-INTEGRATION.md` ä¸­æè¿°**ï¼šMTF è¶‹åŠ¿è¿‡æ»¤æ ‡æ³¨ä¸ºã€Œæ‰‹åŠ¨ calculateIndicatorsã€ï¼Œè¯´æ˜è¿™æ˜¯å·²çŸ¥æƒ…å†µï¼Œä½†ç¼ºä¹é˜²æŠ¤æœºåˆ¶ã€‚

**å½±å“**ï¼šä¸­ç­‰ã€‚å½“å‰ä¸¤ä¾§ä»£ç åŠŸèƒ½ä¸€è‡´ï¼Œä¸å½±å“å®é™…ä¿¡å·ã€‚ä½†è‹¥ä¿®æ”¹ä¸€ä¾§å¿˜è®°åŒæ­¥å¦ä¸€ä¾§ï¼Œä¼šé€ æˆä¸¤æ¡ç®¡çº¿è¡Œä¸ºä¸ä¸€è‡´ï¼Œè¿åã€ŒåŒè·¯å¾„å¿…é¡»å®Œå…¨ä¸€è‡´ã€æ ¸å¿ƒè§„åˆ™ã€‚

**å»ºè®®**ï¼šå°† MTF è¿‡æ»¤å°è£…ä¸º `checkMtfTrend(symbol, cfg, provider): Promise<boolean | null>` å¹¶åœ¨ä¸¤å¤„ç»Ÿä¸€è°ƒç”¨ï¼Œæˆ–çº³å…¥ `processSignal()` å†…éƒ¨ã€‚

---

### A-002 âš ï¸ é€šçŸ¥å†·å´åœ¨ MTF/æƒ…ç»ªè¿‡æ»¤ä¹‹å‰æ¶ˆè€—ï¼Œå¯èƒ½é™é»˜ä¸¢å¼ƒæœ‰æ•ˆä¿¡å·

**ç±»å‹**ï¼šé€»è¾‘é—®é¢˜

**æè¿°**ï¼š
`monitor.ts` ä¸­ï¼Œ`shouldNotify()` å†·å´æ£€æŸ¥å’Œ `state.lastSignals` æ—¶é—´æˆ³æ›´æ–°ï¼ˆçº¦ L240ï¼‰å‘ç”Ÿåœ¨ MTF è¶‹åŠ¿è¿‡æ»¤å’Œæƒ…ç»ªé—¨æ§**ä¹‹å‰**ã€‚è¿™æ„å‘³ç€ï¼šè‹¥ä¸€ä¸ªä¿¡å·é€šè¿‡äº† `processSignal()` ä½†è¢« MTF æˆ–æƒ…ç»ªè¿‡æ»¤æ‹’ç»ï¼Œä»ç„¶æ¶ˆè€—äº†é€šçŸ¥å†·å´çª—å£ã€‚

**ä»£ç æ³¨é‡Š**ï¼ˆL238ï¼‰ï¼š
```typescript
// ğŸ› Fix: é€šçŸ¥å†·å´åœ¨ MTF/æƒ…ç»ªè¿‡æ»¤ä¹‹å‰ç”Ÿæ•ˆï¼Œé˜²æ­¢è¢«è¿‡æ»¤çš„ä¿¡å·ç»•è¿‡ min_interval_minutes
```

è¿™æ®µæ³¨é‡Šè¯´æ˜è¿™æ˜¯**æœ‰æ„ä¸ºä¹‹çš„ bug fix**ï¼Œç›®çš„æ˜¯é˜²æ­¢åŒä¸€ç±»å‹ä¿¡å·åœ¨å†·å´æœŸå†…è¢«è¿‡æ»¤åç«‹å³é‡æ–°é€šçŸ¥ã€‚ä½†ä¹Ÿæ„å‘³ç€åœ¨å†·å´æœŸå†…è¢« MTF è¿‡æ»¤çš„æœ‰æ•ˆæ–¹å‘å˜åŒ–å°†è¢«é™é»˜ä¸¢å¼ƒã€‚

**å½±å“**ï¼šä½ã€‚åœ¨ç­–ç•¥è¶‹äºç¨³å®šçš„æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¿¡å·ç±»å‹åœ¨ 30 åˆ†é’Ÿå†…é€šå¸¸ä¸ä¼šæ¥å›åˆ‡æ¢æ–¹å‘ã€‚ä½†åœ¨å¸‚åœºå¿«é€Ÿå˜åŒ–æ—¶ï¼Œå¯èƒ½å¯¼è‡´é‡è¦ä¿¡å·è¢«å†·å´çª—å£å±è”½ã€‚

**å»ºè®®**ï¼šæ·»åŠ æ—¥å¿—è®°å½•è¢«å†·å´å±è”½çš„ä¿¡å·ç±»å‹ï¼Œæ–¹ä¾¿äº‹ååˆ†æã€‚

---

### A-003 â„¹ï¸ short ä¿¡å·åœ¨ spot å¸‚åœºè¢«é™é»˜è·³è¿‡ï¼Œä»… paper engine å±‚é¢

**ç±»å‹**ï¼šä¿¡æ¯è¯´æ˜ / æ½œåœ¨è¯¯å¯¼

**æè¿°**ï¼š
`engine.ts` ä¸­ `handleSignal()` å¯¹ `short` ä¿¡å·æœ‰å¸‚åœºç±»å‹æ£€æŸ¥ï¼š

```typescript
if (market !== "futures" && market !== "margin") {
  skipped = `å¼€ç©ºä¿¡å·è¢«å¿½ç•¥ï¼šå½“å‰å¸‚åœºç±»å‹ä¸º ${market}ï¼Œåšç©ºéœ€è¦ futures æˆ– margin`;
}
```

ä½† testnet-default åœºæ™¯é…ç½® `exchange.market: "spot"` ä¸” `strategy_id: "long-short"`ï¼ˆåŒ…å« short/cover ä¿¡å·ï¼‰ã€‚è¿™æ„å‘³ç€ï¼š**åšç©ºä¿¡å·ä¼šè¢«æ£€æµ‹åˆ°ã€é€šçŸ¥å‘å‡ºï¼Œä½†æ‰§è¡Œæ—¶è¢« paper engine é™é»˜è·³è¿‡**ã€‚

**å½±å“**ï¼šåœ¨ spot å¸‚åœºä¸‹åšç©ºä¿¡å·ä¸ä¼šè¢«å®é™…æ‰§è¡Œï¼Œä½†ä¼šäº§ç”Ÿé€šçŸ¥ã€‚å¯èƒ½é€ æˆè¯¯è§£ï¼Œè®¤ä¸ºå·²å¼€ç©ºä»“ä½ä½†å®é™…æ²¡æœ‰ã€‚

**å»ºè®®**ï¼š
1. åœ¨ `live-monitor.ts` å’Œ `monitor.ts` çš„ä¿¡å·æ£€æµ‹é˜¶æ®µå¢åŠ å¸‚åœºç±»å‹å‰ç½®æ£€æŸ¥ï¼Œå¯¹ spot å¸‚åœºç›´æ¥è·³è¿‡ `short` ä¿¡å·ï¼Œé¿å…å‘å‡ºæ— æ³•æ‰§è¡Œçš„é€šçŸ¥ã€‚
2. æˆ–è€…å°† testnet-default åœºæ™¯åˆ‡æ¢ä¸º `market: "futures"` ä»¥çœŸæ­£å¯ç”¨åŒå‘äº¤æ˜“ã€‚

---

### A-004 â„¹ï¸ Kelly ä»“ä½è¯»å– signal-history.jsonl è·¯å¾„çš„è®¡ç®—æ–¹å¼

**ç±»å‹**ï¼šä»£ç å¥å£®æ€§

**æè¿°**ï¼š
`monitor.ts` å’Œ `live-monitor.ts` ä¸­ Kelly ä»“ä½çš„ `histPath` å‡é€šè¿‡ `import.meta.url` è®¡ç®—ï¼š

```typescript
const histPath = path.resolve(
  path.dirname(new URL(import.meta.url).pathname),
  "../../logs/signal-history.jsonl"
);
```

`monitor.ts` åœ¨ `src/` ç›®å½•ï¼Œ`live-monitor.ts` åœ¨ `src/scripts/` ç›®å½•ï¼Œä¸¤è€…è·¯å¾„è®¡ç®—ä¸åŒï¼ˆ`../../logs` vs `../../logs`ï¼‰ä½†å‡æ­£ç¡®æŒ‡å‘ `logs/signal-history.jsonl`ã€‚

**å½±å“**ï¼šæ— ï¼Œè·¯å¾„è®¡ç®—å‡æ­£ç¡®ã€‚è®°å½•ä¾›åç»­ç»´æŠ¤è€…å‚è€ƒï¼Œé¿å…è¯¯æ”¹è·¯å¾„å±‚çº§ã€‚

---

### A-005 âœ… [å·²ä¿®å¤ 47f6366] Protection Manager çš„ recentTrades åœ¨ monitor.ts ä¸­æœªä¼ å…¥

**ç±»å‹**ï¼šåŠŸèƒ½æœªæ¿€æ´»

**æè¿°**ï¼š
`processSignal()` çš„ç¬¬ 5 ä¸ªå‚æ•° `recentTrades` ç”¨äº Protection Managerã€‚æŸ¥çœ‹ `monitor.ts` è°ƒç”¨ï¼š

```typescript
const engineResult = processSignal(symbol, klines, cfg, externalCtx);
// â†‘ æ²¡æœ‰ä¼ å…¥ recentTrades
```

`live-monitor.ts` åŒæ ·æ²¡æœ‰ä¼ å…¥ `recentTrades`ã€‚

**å½±å“**ï¼šProtection Managerï¼ˆcooldown / stoploss_guard / max_drawdown ä¿æŠ¤ï¼‰**å®é™…æœªç”Ÿæ•ˆ**ï¼Œå°½ç®¡ä»£ç å·²å®ç°ä¸” `MODULE-INTEGRATION.md` æ ‡æ³¨ä¸º âœ…ã€‚

**å»ºè®®**ï¼šä» `signal-history.jsonl` è¯»å–æœ€è¿‘å¹³ä»“è®°å½•å¹¶ä¼ å…¥ `processSignal()`ï¼Œæ¿€æ´» Protection Manager åŠŸèƒ½ã€‚

---

### A-006 â„¹ï¸ Regime è¿‡æ»¤ç½®ä¿¡åº¦é˜ˆå€¼ä¸º 60ï¼Œæœªé€šè¿‡é…ç½®æ–‡ä»¶æš´éœ²

**ç±»å‹**ï¼šé…ç½®ç¡¬ç¼–ç 

**æè¿°**ï¼š
`signal-engine.ts` ä¸­ï¼š
```typescript
if (regime.confidence >= 60) {
```
é˜ˆå€¼ `60` ç¡¬ç¼–ç ï¼Œæ— æ³•é€šè¿‡ YAML é…ç½®è°ƒæ•´ã€‚

**å½±å“**ï¼šä½ã€‚ä½†è‹¥éœ€è¦è°ƒæ•´çµæ•åº¦ï¼ˆå¦‚å‡è‡³ 75 å‡å°‘è¯¯è§¦å‘ï¼‰ï¼Œéœ€ä¿®æ”¹ä»£ç ã€‚

**å»ºè®®**ï¼šå°†é˜ˆå€¼æå–ä¸ºé…ç½®é¡¹ `regime_confidence_threshold`ã€‚

---

### A-007 âœ… [å·²ä¿®å¤ 47f6366] åˆ†æ‰¹æ­¢ç›ˆï¼ˆstaged_TPï¼‰ä»…æ”¯æŒå¤šå¤´ï¼Œç©ºå¤´æŒä»“æ—  tpStages åˆå§‹åŒ–

**ç±»å‹**ï¼šåŠŸèƒ½ç¼ºå£

**æè¿°**ï¼š
`engine.ts` ä¸­ï¼Œ`tpStages` åˆå§‹åŒ–åœ¨ buy ä¿¡å·å¤„ç†é€»è¾‘ä¸­ï¼ˆçº¦ L137-145ï¼‰ã€‚short ä¿¡å·å¤„ç†å—ï¼ˆçº¦ L200-260ï¼‰ä¸­**æœªåˆå§‹åŒ–** `tpStages`ã€‚

**å½±å“**ï¼šåšç©ºæ—¶åˆ†æ‰¹æ­¢ç›ˆä¸ç”Ÿæ•ˆï¼Œç©ºå¤´æŒä»“åªæœ‰å›ºå®šæ­¢ç›ˆè§¦å‘ã€‚

**å»ºè®®**ï¼šåœ¨ short ä¿¡å·çš„ `newShortPos` åˆå§‹åŒ–åï¼Œæ·»åŠ åŒ buy é€»è¾‘ä¸€è‡´çš„ `tpStages` åˆå§‹åŒ–ä»£ç ã€‚

---

### A-008 â„¹ï¸ çŠ¶æ€æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´ï¼šgetStatePath ä½¿ç”¨ state-ï¼Œéƒ¨åˆ†æ–‡æ¡£å¼•ç”¨ monitor-state-

**ç±»å‹**ï¼šæ–‡æ¡£ä¸ä¸€è‡´

**æè¿°**ï¼š
`monitor.ts` ä¸­å®šä¹‰ï¼š
```typescript
function getStatePath(scenarioId: string): string {
  return path.resolve(__dirname, `../logs/state-${scenarioId}.json`);
}
```
å®é™…è·¯å¾„ä¸º `logs/state-{scenarioId}.json`ï¼Œä½†æœ¬æ–‡æ¡£è¦æ±‚æè¿°ä¸º `logs/monitor-state-{scenarioId}.json`ã€‚

**å½±å“**ï¼šä»…æ–‡æ¡£ä¸ä¸€è‡´ï¼Œä¸å½±å“åŠŸèƒ½ã€‚

**å»ºè®®**ï¼šç»Ÿä¸€æ–‡æ¡£æè¿°ä¸º `logs/state-{scenarioId}.json`ï¼ˆä»¥ä»£ç ä¸ºå‡†ï¼‰ã€‚

---

*å®¡è®¡å®Œæˆäº 2026-02-26 by Mia*
*æœ¬æ–‡æ¡£æ€»è¡Œæ•°çº¦ 900 è¡Œï¼Œç¬¦åˆè¦æ±‚èŒƒå›´ï¼ˆ800-1200 è¡Œï¼‰*
